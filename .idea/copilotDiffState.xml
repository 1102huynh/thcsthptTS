<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/FRESH_DATABASE_SETUP.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/FRESH_DATABASE_SETUP.sql" />
              <option name="updatedContent" value="DROP DATABASE IF EXISTS school_management;&#10;CREATE DATABASE school_management;&#10;USE school_management;&#10;&#10;CREATE TABLE roles (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(255) UNIQUE NOT NULL,&#10;    description VARCHAR(500)&#10;);&#10;&#10;CREATE TABLE users (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    username VARCHAR(255) UNIQUE NOT NULL,&#10;    password VARCHAR(255) NOT NULL,&#10;    email VARCHAR(255) UNIQUE NOT NULL,&#10;    first_name VARCHAR(255) NOT NULL,&#10;    last_name VARCHAR(255) NOT NULL,&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#10;);&#10;&#10;CREATE TABLE user_roles (&#10;    user_id BIGINT NOT NULL,&#10;    role_id BIGINT NOT NULL,&#10;    PRIMARY KEY (user_id, role_id),&#10;    FOREIGN KEY (user_id) REFERENCES users(id),&#10;    FOREIGN KEY (role_id) REFERENCES roles(id)&#10;);&#10;&#10;INSERT INTO roles (name, description) VALUES ('ADMIN', 'Administrator');&#10;INSERT INTO roles (name, description) VALUES ('USER', 'Regular User');&#10;&#10;INSERT INTO users (username, password, email, first_name, last_name, is_active) &#10;VALUES ('admin', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 'admin@school.com', 'Admin', 'User', 1);&#10;&#10;INSERT INTO user_roles (user_id, role_id) VALUES (1, 1);&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/Application.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/Application.java" />
              <option name="updatedContent" value="package com.school;&#10;import org.springframework.boot.SpringApplication;&#10;import org.springframework.boot.autoconfigure.SpringBootApplication;&#10;@SpringBootApplication public class Application { public static void main(String[] args) { SpringApplication.run(Application.class, args); } }&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/config/SecurityConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/config/SecurityConfig.java" />
              <option name="updatedContent" value="package com.school.config;import com.school.security.CustomUserDetailsService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.security.authentication.AuthenticationManager;import org.springframework.security.authentication.dao.DaoAuthenticationProvider;import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;import org.springframework.security.config.annotation.web.builders.HttpSecurity;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;import org.springframework.security.config.http.SessionCreationPolicy;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;import org.springframework.security.crypto.password.PasswordEncoder;import org.springframework.security.web.SecurityFilterChain;@Configuration @EnableWebSecurity public class SecurityConfig{@Autowired private CustomUserDetailsService userDetailsService;@Bean public PasswordEncoder passwordEncoder(){return new BCryptPasswordEncoder();}@Bean public DaoAuthenticationProvider authenticationProvider(){DaoAuthenticationProvider authProvider=new DaoAuthenticationProvider();authProvider.setUserDetailsService(userDetailsService);authProvider.setPasswordEncoder(passwordEncoder());return authProvider;}@Bean public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception{return authConfig.getAuthenticationManager();}@Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{http.csrf(csrf-&gt;csrf.disable()).sessionManagement(session-&gt;session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)).authorizeHttpRequests(authz-&gt;authz.requestMatchers(&quot;/api/v1/auth/**&quot;).permitAll().anyRequest().authenticated());http.authenticationProvider(authenticationProvider());return http.build();}}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/controller/AuthController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/controller/AuthController.java" />
              <option name="updatedContent" value="package com.school.controller;import com.school.dto.AuthResponse;import com.school.dto.LoginRequest;import com.school.service.AuthService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.ResponseEntity;import org.springframework.web.bind.annotation.*;@RestController @RequestMapping(&quot;/api/v1/auth&quot;) @CrossOrigin(&quot;http://localhost:3000&quot;) public class AuthController{@Autowired private AuthService authService;@PostMapping(&quot;/login&quot;) public ResponseEntity&lt;AuthResponse&gt; login(@RequestBody LoginRequest req){return ResponseEntity.ok(authService.login(req));}}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/dto/AuthResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/dto/AuthResponse.java" />
              <option name="updatedContent" value="package com.school.dto;import lombok.AllArgsConstructor;import lombok.Builder;import lombok.Data;import lombok.NoArgsConstructor;import java.util.Set;@Data @AllArgsConstructor @NoArgsConstructor @Builder public class AuthResponse{private Long id;private String username;private String email;private String firstName;private String lastName;private String accessToken;private Set&lt;String&gt; roles;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/dto/LoginRequest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/dto/LoginRequest.java" />
              <option name="updatedContent" value="package com.school.dto;import lombok.Data;@Data public class LoginRequest{private String username;private String password;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/entity/Role.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/entity/Role.java" />
              <option name="updatedContent" value="package com.school.entity;import jakarta.persistence.*;import lombok.Data;@Entity @Table(name=&quot;roles&quot;)@Data public class Role{@Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Long id;@Column(unique=true,nullable=false) private String name;private String description;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/entity/User.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/entity/User.java" />
              <option name="updatedContent" value="package com.school.entity;import jakarta.persistence.*;import lombok.Data;import java.util.HashSet;import java.util.Set;@Entity @Table(name=&quot;users&quot;)@Data public class User{@Id @GeneratedValue(strategy=GenerationType.IDENTITY) private Long id;@Column(unique=true,nullable=false) private String username;@Column(nullable=false) private String password;@Column(unique=true,nullable=false) private String email;@Column(nullable=false) private String firstName;@Column(nullable=false) private String lastName;@Column(nullable=false) private Boolean isActive=true;@ManyToMany(fetch=FetchType.EAGER) @JoinTable(name=&quot;user_roles&quot;,joinColumns=@JoinColumn(name=&quot;user_id&quot;),inverseJoinColumns=@JoinColumn(name=&quot;role_id&quot;)) private Set&lt;Role&gt; roles=new HashSet&lt;&gt;();}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/repository/RoleRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/repository/RoleRepository.java" />
              <option name="updatedContent" value="package com.school.repository;import com.school.entity.Role;import org.springframework.data.jpa.repository.JpaRepository;import java.util.Optional;public interface RoleRepository extends JpaRepository&lt;Role,Long&gt;{Optional&lt;Role&gt; findByName(String name);}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/repository/UserRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/repository/UserRepository.java" />
              <option name="updatedContent" value="package com.school.repository;import com.school.entity.User;import org.springframework.data.jpa.repository.JpaRepository;import java.util.Optional;public interface UserRepository extends JpaRepository&lt;User,Long&gt;{Optional&lt;User&gt; findByUsername(String username);}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/security/CustomUserDetailsService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/security/CustomUserDetailsService.java" />
              <option name="updatedContent" value="package com.school.security;import com.school.entity.User;import com.school.repository.UserRepository;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.core.authority.SimpleGrantedAuthority;import org.springframework.security.core.userdetails.*;import org.springframework.stereotype.Service;import java.util.stream.Collectors;@Service public class CustomUserDetailsService implements UserDetailsService{@Autowired private UserRepository userRepository;@Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException{User user=userRepository.findByUsername(username).orElseThrow(()-&gt;new UsernameNotFoundException(&quot;User not found&quot;));return org.springframework.security.core.userdetails.User.builder().username(user.getUsername()).password(user.getPassword()).authorities(user.getRoles().stream().map(r-&gt;new SimpleGrantedAuthority(&quot;ROLE_&quot;+r.getName())).collect(Collectors.toList())).build();}}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/security/JwtTokenProvider.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/security/JwtTokenProvider.java" />
              <option name="updatedContent" value="package com.school.security;import io.jsonwebtoken.*;import io.jsonwebtoken.security.Keys;import org.springframework.beans.factory.annotation.Value;import org.springframework.security.core.Authentication;import org.springframework.stereotype.Component;import java.util.Date;@Component public class JwtTokenProvider{@Value(&quot;${jwt.secret}&quot;) private String jwtSecret;@Value(&quot;${jwt.expiration}&quot;) private long jwtExpirationMs;public String generateToken(Authentication auth){byte[] key=jwtSecret.getBytes();Date now=new Date();Date expiryDate=new Date(now.getTime()+jwtExpirationMs);return Jwts.builder().setSubject(auth.getName()).setIssuedAt(now).setExpiration(expiryDate).signWith(Keys.hmacShaKeyFor(key),SignatureAlgorithm.HS256).compact();}public String getUsernameFromToken(String token){byte[] key=jwtSecret.getBytes();Claims claims=Jwts.parserBuilder().setSigningKey(Keys.hmacShaKeyFor(key)).build().parseClaimsJws(token).getBody();return claims.getSubject();}public boolean validateToken(String token){try{byte[] key=jwtSecret.getBytes();Jwts.parserBuilder().setSigningKey(Keys.hmacShaKeyFor(key)).build().parseClaimsJws(token);return true;}catch(Exception e){return false;}}}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/school/service/AuthService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/school/service/AuthService.java" />
              <option name="updatedContent" value="package com.school.service;import com.school.dto.AuthResponse;import com.school.dto.LoginRequest;import com.school.entity.User;import com.school.repository.UserRepository;import com.school.security.JwtTokenProvider;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.security.authentication.AuthenticationManager;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;import org.springframework.security.core.Authentication;import org.springframework.stereotype.Service;import java.util.stream.Collectors;@Service public class AuthService{@Autowired private AuthenticationManager authenticationManager;@Autowired private JwtTokenProvider tokenProvider;@Autowired private UserRepository userRepository;public AuthResponse login(LoginRequest req){Authentication auth=authenticationManager.authenticate(new UsernamePasswordAuthenticationToken(req.getUsername(),req.getPassword()));User user=userRepository.findByUsername(req.getUsername()).orElseThrow();String token=tokenProvider.generateToken(auth);return AuthResponse.builder().id(user.getId()).username(user.getUsername()).email(user.getEmail()).firstName(user.getFirstName()).lastName(user.getLastName()).accessToken(token).roles(user.getRoles().stream().map(r-&gt;r.getName()).collect(Collectors.toSet())).build();}}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/config/SecurityConfig.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/config/SecurityConfig.java" />
              <option name="updatedContent" value="package com.schoolms.config;&#10;&#10;import com.schoolms.security.JwtAuthenticationFilter;&#10;import com.schoolms.security.CustomUserDetailsService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.context.annotation.Bean;&#10;import org.springframework.context.annotation.Configuration;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.authentication.dao.DaoAuthenticationProvider;&#10;import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;&#10;import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;&#10;import org.springframework.security.config.annotation.web.builders.HttpSecurity;&#10;import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;&#10;import org.springframework.security.config.http.SessionCreationPolicy;&#10;import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.security.web.SecurityFilterChain;&#10;import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;&#10;import org.springframework.web.cors.CorsConfiguration;&#10;import org.springframework.web.cors.CorsConfigurationSource;&#10;import org.springframework.web.cors.UrlBasedCorsConfigurationSource;&#10;&#10;import java.util.Arrays;&#10;&#10;@Configuration&#10;@EnableWebSecurity&#10;@EnableMethodSecurity(prePostEnabled = true)&#10;public class SecurityConfig {&#10;&#10;    @Autowired&#10;    private CustomUserDetailsService customUserDetailsService;&#10;&#10;    @Autowired&#10;    private JwtAuthenticationFilter jwtAuthenticationFilter;&#10;&#10;    @Bean&#10;    public PasswordEncoder passwordEncoder() {&#10;        return new BCryptPasswordEncoder();&#10;    }&#10;&#10;    @Bean&#10;    public DaoAuthenticationProvider authenticationProvider() {&#10;        DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();&#10;        authProvider.setUserDetailsService(customUserDetailsService);&#10;        authProvider.setPasswordEncoder(passwordEncoder());&#10;        return authProvider;&#10;    }&#10;&#10;    @Bean&#10;    public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {&#10;        return authConfig.getAuthenticationManager();&#10;    }&#10;&#10;    @Bean&#10;    public CorsConfigurationSource corsConfigurationSource() {&#10;        CorsConfiguration configuration = new CorsConfiguration();&#10;        configuration.setAllowedOrigins(Arrays.asList(&quot;http://localhost:3000&quot;, &quot;http://localhost:8080&quot;));&#10;        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;PATCH&quot;, &quot;OPTIONS&quot;));&#10;        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));&#10;        configuration.setExposedHeaders(Arrays.asList(&quot;Authorization&quot;));&#10;        configuration.setAllowCredentials(true);&#10;        configuration.setMaxAge(3600L);&#10;&#10;        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();&#10;        source.registerCorsConfiguration(&quot;/**&quot;, configuration);&#10;        return source;&#10;    }&#10;&#10;    @Bean&#10;    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {&#10;        http.csrf(csrf -&gt; csrf.disable())&#10;                .cors(cors -&gt; cors.configurationSource(corsConfigurationSource()))&#10;                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))&#10;                .authorizeHttpRequests(authz -&gt; authz&#10;                        .requestMatchers(&quot;/api/v1/auth/**&quot;).permitAll()&#10;                        .anyRequest().authenticated()&#10;                );&#10;&#10;        http.authenticationProvider(authenticationProvider());&#10;        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);&#10;&#10;        return http.build();&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/controller/AuthController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/controller/AuthController.java" />
              <option name="updatedContent" value="package com.schoolms.controller;&#10;&#10;import com.schoolms.dto.AuthResponse;&#10;import com.schoolms.dto.LoginRequest;&#10;import com.schoolms.service.AuthService;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.http.ResponseEntity;&#10;import org.springframework.web.bind.annotation.*;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/v1/auth&quot;)&#10;@CrossOrigin(origins = &quot;http://localhost:3000&quot;)&#10;public class AuthController {&#10;&#10;    @Autowired&#10;    private AuthService authService;&#10;&#10;    @PostMapping(&quot;/login&quot;)&#10;    public ResponseEntity&lt;AuthResponse&gt; login(@RequestBody LoginRequest loginRequest) {&#10;        AuthResponse response = authService.login(loginRequest);&#10;        return ResponseEntity.ok(response);&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/dto/AuthResponse.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/dto/AuthResponse.java" />
              <option name="updatedContent" value="package com.schoolms.dto;&#10;&#10;import lombok.AllArgsConstructor;&#10;import lombok.Builder;&#10;import lombok.Data;&#10;import lombok.NoArgsConstructor;&#10;&#10;import java.util.Set;&#10;&#10;@Data&#10;@NoArgsConstructor&#10;@AllArgsConstructor&#10;@Builder&#10;public class AuthResponse {&#10;    private Long id;&#10;    private String username;&#10;    private String email;&#10;    private String firstName;&#10;    private String lastName;&#10;    private String accessToken;&#10;    private String refreshToken;&#10;    private Set&lt;String&gt; roles;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/dto/LoginRequest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/dto/LoginRequest.java" />
              <option name="updatedContent" value="package com.schoolms.dto;&#10;&#10;import lombok.AllArgsConstructor;&#10;import lombok.Data;&#10;import lombok.NoArgsConstructor;&#10;&#10;@Data&#10;@NoArgsConstructor&#10;@AllArgsConstructor&#10;public class LoginRequest {&#10;    private String username;&#10;    private String password;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/entity/Role.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/entity/Role.java" />
              <option name="updatedContent" value="package com.schoolms.entity;&#10;&#10;import jakarta.persistence.*;&#10;import lombok.AllArgsConstructor;&#10;import lombok.Data;&#10;import lombok.NoArgsConstructor;&#10;&#10;@Entity&#10;@Table(name = &quot;roles&quot;)&#10;@Data&#10;@NoArgsConstructor&#10;@AllArgsConstructor&#10;public class Role {&#10;&#10;    @Id&#10;    @GeneratedValue(strategy = GenerationType.IDENTITY)&#10;    private Long id;&#10;&#10;    @Column(nullable = false, unique = true)&#10;    private String name;&#10;&#10;    @Column&#10;    private String description;&#10;&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/repository/RoleRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/repository/RoleRepository.java" />
              <option name="updatedContent" value="package com.schoolms.repository;&#10;&#10;import com.schoolms.entity.Role;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public interface RoleRepository extends JpaRepository&lt;Role, Long&gt; {&#10;    Optional&lt;Role&gt; findByName(String name);&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/repository/UserRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/repository/UserRepository.java" />
              <option name="updatedContent" value="package com.schoolms.repository;&#10;&#10;import com.schoolms.entity.User;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import org.springframework.stereotype.Repository;&#10;&#10;import java.util.Optional;&#10;&#10;@Repository&#10;public interface UserRepository extends JpaRepository&lt;User, Long&gt; {&#10;    Optional&lt;User&gt; findByUsername(String username);&#10;    Optional&lt;User&gt; findByEmail(String email);&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/security/CustomUserDetailsService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/security/CustomUserDetailsService.java" />
              <option name="updatedContent" value="package com.schoolms.security;&#10;&#10;import com.schoolms.entity.User;&#10;import com.schoolms.repository.UserRepository;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.security.core.GrantedAuthority;&#10;import org.springframework.security.core.authority.SimpleGrantedAuthority;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.security.core.userdetails.UserDetailsService;&#10;import org.springframework.security.core.userdetails.UsernameNotFoundException;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.Collection;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class CustomUserDetailsService implements UserDetailsService {&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    @Override&#10;    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {&#10;        User user = userRepository.findByUsername(username)&#10;                .orElseThrow(() -&gt; new UsernameNotFoundException(&quot;User not found with username: &quot; + username));&#10;&#10;        Boolean isActive = user.getIsActive() != null ? user.getIsActive() : true;&#10;&#10;        return org.springframework.security.core.userdetails.User.builder()&#10;                .username(user.getUsername())&#10;                .password(user.getPassword())&#10;                .authorities(getAuthorities(user))&#10;                .accountExpired(!isActive)&#10;                .accountLocked(!isActive)&#10;                .build();&#10;    }&#10;&#10;    private Collection&lt;? extends GrantedAuthority&gt; getAuthorities(User user) {&#10;        return user.getRoles().stream()&#10;                .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getName()))&#10;                .collect(Collectors.toList());&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/security/JwtAuthenticationFilter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/security/JwtAuthenticationFilter.java" />
              <option name="updatedContent" value="package com.schoolms.security;&#10;&#10;import jakarta.servlet.FilterChain;&#10;import jakarta.servlet.ServletException;&#10;import jakarta.servlet.http.HttpServletRequest;&#10;import jakarta.servlet.http.HttpServletResponse;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;&#10;import org.springframework.security.core.context.SecurityContextHolder;&#10;import org.springframework.security.core.userdetails.UserDetails;&#10;import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;&#10;import org.springframework.stereotype.Component;&#10;import org.springframework.util.StringUtils;&#10;import org.springframework.web.filter.OncePerRequestFilter;&#10;&#10;import java.io.IOException;&#10;&#10;@Component&#10;public class JwtAuthenticationFilter extends OncePerRequestFilter {&#10;&#10;    @Autowired&#10;    private JwtTokenProvider tokenProvider;&#10;&#10;    @Autowired&#10;    private CustomUserDetailsService userDetailsService;&#10;&#10;    @Override&#10;    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)&#10;            throws ServletException, IOException {&#10;&#10;        try {&#10;            String jwt = getJwtFromRequest(request);&#10;&#10;            if (StringUtils.hasText(jwt) &amp;&amp; tokenProvider.validateToken(jwt)) {&#10;                String username = tokenProvider.getUsernameFromToken(jwt);&#10;                UserDetails userDetails = userDetailsService.loadUserByUsername(username);&#10;&#10;                UsernamePasswordAuthenticationToken authentication =&#10;                        new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());&#10;                authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));&#10;&#10;                SecurityContextHolder.getContext().setAuthentication(authentication);&#10;            }&#10;        } catch (Exception ex) {&#10;            logger.error(&quot;Could not set user authentication in security context&quot;, ex);&#10;        }&#10;&#10;        filterChain.doFilter(request, response);&#10;    }&#10;&#10;    private String getJwtFromRequest(HttpServletRequest request) {&#10;        String bearerToken = request.getHeader(&quot;Authorization&quot;);&#10;        if (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) {&#10;            return bearerToken.substring(7);&#10;        }&#10;        return null;&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/java/com/schoolms/service/AuthService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/java/com/schoolms/service/AuthService.java" />
              <option name="updatedContent" value="package com.schoolms.service;&#10;&#10;import com.schoolms.dto.AuthResponse;&#10;import com.schoolms.dto.LoginRequest;&#10;import com.schoolms.entity.User;&#10;import com.schoolms.exception.BadRequestException;&#10;import com.schoolms.repository.UserRepository;&#10;import com.schoolms.security.JwtTokenProvider;&#10;import org.slf4j.Logger;&#10;import org.slf4j.LoggerFactory;&#10;import org.springframework.beans.factory.annotation.Autowired;&#10;import org.springframework.security.authentication.AuthenticationManager;&#10;import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;&#10;import org.springframework.security.core.Authentication;&#10;import org.springframework.stereotype.Service;&#10;&#10;import java.util.stream.Collectors;&#10;&#10;@Service&#10;public class AuthService {&#10;&#10;    private static final Logger logger = LoggerFactory.getLogger(AuthService.class);&#10;&#10;    @Autowired&#10;    private AuthenticationManager authenticationManager;&#10;&#10;    @Autowired&#10;    private JwtTokenProvider jwtTokenProvider;&#10;&#10;    @Autowired&#10;    private UserRepository userRepository;&#10;&#10;    public AuthResponse login(LoginRequest loginRequest) {&#10;        try {&#10;            logger.info(&quot;Login attempt for username: {}&quot;, loginRequest.getUsername());&#10;&#10;            Authentication authentication = authenticationManager.authenticate(&#10;                    new UsernamePasswordAuthenticationToken(&#10;                            loginRequest.getUsername(),&#10;                            loginRequest.getPassword()&#10;                    )&#10;            );&#10;&#10;            logger.info(&quot;Authentication successful for username: {}&quot;, loginRequest.getUsername());&#10;&#10;            User user = userRepository.findByUsername(loginRequest.getUsername())&#10;                    .orElseThrow(() -&gt; new BadRequestException(&quot;Invalid username or password&quot;));&#10;&#10;            logger.info(&quot;User found: {}, Roles: {}&quot;, user.getUsername(), user.getRoles());&#10;&#10;            String accessToken = jwtTokenProvider.generateAccessToken(authentication);&#10;            String refreshToken = jwtTokenProvider.generateRefreshToken(user.getUsername());&#10;&#10;            return AuthResponse.builder()&#10;                    .id(user.getId())&#10;                    .username(user.getUsername())&#10;                    .email(user.getEmail())&#10;                    .firstName(user.getFirstName())&#10;                    .lastName(user.getLastName())&#10;                    .accessToken(accessToken)&#10;                    .refreshToken(refreshToken)&#10;                    .roles(user.getRoles().stream()&#10;                            .map(role -&gt; role.getName())&#10;                            .collect(Collectors.toSet()))&#10;                    .build();&#10;        } catch (Exception ex) {&#10;            logger.error(&quot;Login failed&quot;, ex);&#10;            throw new BadRequestException(&quot;Invalid username or password&quot;);&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/backend/src/main/resources/data.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/backend/src/main/resources/data.sql" />
              <option name="updatedContent" value="INSERT INTO roles (id, name, description) VALUES (1, 'ADMIN', 'Administrator');&#10;INSERT INTO roles (id, name, description) VALUES (2, 'USER', 'Regular User');&#10;INSERT INTO users (id, username, password, email, first_name, last_name, is_active) VALUES (1, 'admin', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 'admin@school.com', 'Admin', 'User', 1);&#10;INSERT INTO user_roles (user_id, role_id) VALUES (1, 1);&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/setup-database.sql">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/setup-database.sql" />
              <option name="updatedContent" value="-- Drop existing database&#10;DROP DATABASE IF EXISTS school_management;&#10;&#10;-- Create new database&#10;CREATE DATABASE school_management;&#10;USE school_management;&#10;&#10;-- Create roles table&#10;CREATE TABLE roles (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    name VARCHAR(255) UNIQUE NOT NULL,&#10;    description VARCHAR(500)&#10;);&#10;&#10;-- Create users table&#10;CREATE TABLE users (&#10;    id BIGINT AUTO_INCREMENT PRIMARY KEY,&#10;    username VARCHAR(255) UNIQUE NOT NULL,&#10;    password VARCHAR(255) NOT NULL,&#10;    email VARCHAR(255) UNIQUE NOT NULL,&#10;    first_name VARCHAR(255) NOT NULL,&#10;    last_name VARCHAR(255) NOT NULL,&#10;    is_active BOOLEAN DEFAULT TRUE,&#10;    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#10;);&#10;&#10;-- Create user_roles junction table&#10;CREATE TABLE user_roles (&#10;    user_id BIGINT NOT NULL,&#10;    role_id BIGINT NOT NULL,&#10;    PRIMARY KEY (user_id, role_id),&#10;    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,&#10;    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE&#10;);&#10;&#10;-- Insert roles&#10;INSERT INTO roles (name, description) VALUES ('ADMIN', 'Administrator');&#10;INSERT INTO roles (name, description) VALUES ('USER', 'User');&#10;&#10;-- Insert admin user&#10;-- Username: admin&#10;-- Password: admin123&#10;-- BCrypt hash: $2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG&#10;INSERT INTO users (username, password, email, first_name, last_name, is_active) &#10;VALUES ('admin', '$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG', 'admin@school.com', 'Admin', 'User', 1);&#10;&#10;-- Assign ADMIN role to admin user&#10;INSERT INTO user_roles (user_id, role_id) &#10;SELECT u.id, r.id FROM users u, roles r WHERE u.username='admin' AND r.name='ADMIN';&#10;&#10;-- Verify data&#10;SELECT 'Roles:' as info;&#10;SELECT * FROM roles;&#10;SELECT 'Users:' as info;&#10;SELECT * FROM users;&#10;SELECT 'User Roles:' as info;&#10;SELECT * FROM user_roles;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>